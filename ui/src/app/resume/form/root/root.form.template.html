<div class="flex justify-between mb-3">
  <button matButton="outlined" (click)="accordion().closeAll()">
    <mat-icon fontSet="material-symbols-outlined">collapse_all</mat-icon> Collapse All
  </button>
  <button matButton="tonal" (click)="addSection()"><mat-icon>add</mat-icon> Add Section</button>
</div>

<mat-accordion
  cdkDropList
  [multi]="true"
  (cdkDropListDropped)="onDrop($event)"
  [cdkDropListData]="service.sections.controls"
>
  <mat-expansion-panel>
    <mat-expansion-panel-header>
      <mat-panel-title> Profile </mat-panel-title>
    </mat-expansion-panel-header>
    <profile-form [form]="service.profile" />
  </mat-expansion-panel>
  @for (section of this.service.sections.controls; track $index) {
  <mat-expansion-panel cdkDrag #sections #matSections>
    <mat-expansion-panel-header class="relative flex group">
      <drag-handle cdkDragHandle class="absolute inset-y-0 left-0 flex items-center px-1" />
      <mat-panel-title class="relative flex-1">
        <title-input-form
          [control]="$any(section.get('title'))"
          placeholder="Enter Section Title..."
        />
      </mat-panel-title>
      <mat-panel-description class="!flex-none">
        <span [class.flex]="isTablet()" [class.hidden]="!isTablet()" class="group-hover:flex">
          <delete-button tooltip="Delete Section" (delete)="onDelete($event, $index)" />
        </span>
      </mat-panel-description>
    </mat-expansion-panel-header>
    <div *cdkDragPlaceholder class="h-12 w-full bg-surface-dimmer"></div>
    <section-form
      [idx]="$index"
      [form]="$any(section)"
      (dragMoveOutput)="childDragMoved($event)"
      (dragStartOutput)="childDragStart($event)"
    />
  </mat-expansion-panel>
  }
</mat-accordion>
