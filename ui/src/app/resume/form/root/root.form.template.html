<div class="flex justify-end mb-3">
  <button matButton="tonal" (click)="addSection()"><mat-icon>add</mat-icon> Add Section</button>
</div>

<mat-accordion
  [multi]="true"
  cdkDropList
  [cdkDropListData]="service.sections.controls"
  (cdkDropListDropped)="onDrop($event)"
>
  <mat-expansion-panel>
    <mat-expansion-panel-header>
      <mat-panel-title> Profile </mat-panel-title>
    </mat-expansion-panel-header>
    <profile-form [form]="service.profile" />
  </mat-expansion-panel>
  @for (section of this.service.sections.controls; track $index) {
  <mat-expansion-panel cdkDrag cdkDropList (cdkDropListEntered)="a()" #sections>
    <mat-expansion-panel-header class="relative flex group">
      <drag-handle cdkDragHandle class="absolute inset-y-0 left-0 flex items-center px-1" />
      <mat-panel-title class="relative flex-1">
        <title-input-form
          [control]="$any(section.get('title'))"
          placeholder="Enter Section Title..."
        />
      </mat-panel-title>
      <mat-panel-description class="!flex-none">
        <span class="hidden group-hover:flex">
          <button matIconButton (click)="onDelete($event, $index)">
            <mat-icon fontSet="material-symbols-outlined" class="text-error">delete</mat-icon>
          </button>
        </span>
      </mat-panel-description>
    </mat-expansion-panel-header>
    <div *cdkDragPlaceholder class="h-12 w-full bg-surface-dimmer"></div>
    <section-form [idx]="$index" [form]="$any(section)" />
  </mat-expansion-panel>
  }
</mat-accordion>

<!-- debugging only, will cause console ExpressionChangedAfterItHasBeenCheckedError -->
<pre>{{ service.form.value | json }}</pre>
